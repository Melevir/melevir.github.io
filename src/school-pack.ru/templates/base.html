<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="" />
  <meta name="yandex-verification" content="eb0a76d90d251b60" />
  <link rel="icon" type="image/png" sizes="32x32" href="/static/images/graduate.png"/>


  <meta property="og:type" content="website"/>
  <meta property="og:locale" content="ru_RU"/>
  <meta name="twitter:domain" content="melevir.github.io"/>
  <meta name="twitter:creator" content="melevir@python.ru"/>
  <meta property="og:site_name" content="Школа+"/>
  <meta name="twitter:site" content="Школа+"/>
  <meta property="og:url" content="https://melevir.github.io/"/>
  <meta name="twitter:url" content="https://melevir.github.io/"/>
  <meta property="og:title" content="Школа+"/>
  <meta property="og:description" content="Учимся тому, чему не учат в школе"/>
  <meta property="og:image" content="https://melevir.github.io/static/images/school_plus_fb.png"/>
  <meta property="og:image:secure_url" content="https://melevir.github.io/static/images/school_plus_fb.png"/>
  <meta property="og:image:type" content="image/png"/>
  <meta property="og:image:width" content="600"/>
  <meta property="og:image:height" content="315"/>
  <meta name="twitter:card" content="summary_large_image"/>
  <meta name="twitter:title" content="Школа+"/>
  <meta name="twitter:description" content="Учимся тому, чему не учат в школе"/>
  <meta name="twitter:image:src" content="https://melevir.github.io/static/images/school_plus_fb.png"/>


  <title>Школа+</title>

  <link rel="stylesheet" href="//cdn.rawgit.com/necolas/normalize.css/master/normalize.css">
  <link rel="stylesheet" href="//cdn.rawgit.com/milligram/milligram/master/dist/milligram.min.css">
  <link href="https://use.fontawesome.com/releases/v5.0.6/css/all.css" rel="stylesheet">
  <link href="/static/css/styles.css" rel="stylesheet">
  <link href="/static/vendor/likely_2_3/likely.css" rel="stylesheet">

</head>
<body>
  <!-- Yandex.Metrika counter --> <script type="text/javascript" > (function (d, w, c) { (w[c] = w[c] || []).push(function() { try { w.yaCounter47665243 = new Ya.Metrika({ id:47665243, clickmap:true, trackLinks:true, accurateTrackBounce:true, webvisor:true }); } catch(e) { } }); var n = d.getElementsByTagName("script")[0], s = d.createElement("script"), f = function () { n.parentNode.insertBefore(s, n); }; s.type = "text/javascript"; s.async = true; s.src = "https://mc.yandex.ru/metrika/watch.js"; if (w.opera == "[object Opera]") { d.addEventListener("DOMContentLoaded", f, false); } else { f(); } })(document, window, "yandex_metrika_callbacks"); </script> <noscript><div><img src="https://mc.yandex.ru/watch/47665243" style="position:absolute; left:-9999px;" alt="" /></div></noscript> <!-- /Yandex.Metrika counter -->
  <div class="container">
    <div class="row">
      <div class="column column-80 column-offset-10">
        {% block content %}{% endblock %}

        <div class="footer row">
          <div class="column">
            Сделал <a href="http://melevir.com" target="_blank">Илья</a>.
          </div>
          <div class="column">
            Иконки сделаны на <a href="https://www.freepik.com/" target="_blank">Freepic</a> с <a href="https://www.flaticon.com" target="_blank">flaticon.com</a>.
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
  <script src="/static/vendor/likely_2_3/likely.js"></script>
  <script>
    var localstorageKeyName = 'studentPackMaterialsStat',
      getCurrentStat = function() {
      var stat = localStorage.getItem(localstorageKeyName);
      if (stat == undefined) {
        return {}
      } else {
          return JSON.parse(stat);
      }
    },
    updateItemState = function(topic, subtopic, item, newState) {
      var stat = getCurrentStat();

      stat[topic] = stat[topic] || {};
      stat[topic][subtopic] = stat[topic][subtopic] || {};
      stat[topic][subtopic][item] = stat[topic][subtopic][item] || {};

      stat[topic][subtopic][item] = {state: newState};
      localStorage.setItem(localstorageKeyName, JSON.stringify(stat));
    },
    getItemStatus = function(stat, topic, subtopic, item) {
      stat[topic] = stat[topic] || {};
      stat[topic][subtopic] = stat[topic][subtopic] || {};
      stat[topic][subtopic][item] = stat[topic][subtopic][item] || {};

      var itemStat = stat[topic][subtopic][item];
      if (itemStat != undefined) {
          return itemStat.state;
      }
    },
    redrawMaterialItem = function($li, materialsStat) {
      var subtopicId = $li.closest('ul').data('subtopicId').toString(),
        topicId = $('.topic_content').data('topicId').toString(),
        itemId = $li.data('itemId').toString(),
        itemStatus = getItemStatus(materialsStat, topicId, subtopicId, itemId);
      if (itemStatus == 'got_it') {
          $li.addClass('success');
      } else if (itemStatus == 'visited') {
          $li.append('<span class="got_it_btn">✓ я понял</span>');
      }
    },
    updateMaterialsStatuses = function() {
      var materialLists = $('.topic_content').find('ul'),
        materialsStat = getCurrentStat(),
        itemId,
        $ul,
        $li,
        subtopicId;

      $.each(materialLists, function(index, ul) {
        $ul = $(ul);
        subtopicId = $ul.data('subtopicId');
        if(subtopicId != undefined) {
          $.each($ul.find('li'), function(index, li) {
            $li = $(li);
            itemId = $li.data('itemId').toString();
            redrawMaterialItem($li, materialsStat);
          });
        }
      });
    };

    $('.hider_btn').click(function(e) {
      var $target = $(e.target),
          content = $target.closest('.hider').find('.hider_content');
      $target.hide();
      content.fadeIn();
    });

    $('body').on('click', '.got_it_btn', function(e) {
       var $target = $(e.target),
         li = $target.closest('li'),
         itemId = li.data('itemId'),
         subtopicId = $target.closest('ul').data('subtopicId'),
         topicId = $('.topic_content').data('topicId');

       updateItemState(topicId, subtopicId, itemId, 'got_it');
       redrawMaterialItem($(li), getCurrentStat());
       $target.fadeOut();
    });

    $('.topic_content li>a').click(function(e) {
       var $target = $(e.target),
         li = $target.closest('li'),
         itemId = li.data('itemId'),
         subtopicId = $target.closest('ul').data('subtopicId'),
         topicId = $('.topic_content').data('topicId');

       updateItemState(topicId, subtopicId, itemId, 'visited');
       redrawMaterialItem($(li), getCurrentStat());
    });

    updateMaterialsStatuses();
  </script>
</body>
</html>
